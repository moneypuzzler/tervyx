{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://vera-protocol.org/schemas/entry.schema.json",
  "title": "VERA Protocol Entry Schema", 
  "description": "Schema for entry.jsonld files containing complete VERA assessments",
  "type": "object",
  "properties": {
    "@context": {
      "type": "string",
      "const": "https://schema.org/",
      "description": "JSON-LD context"
    },
    "@type": {
      "type": "string",
      "const": "Dataset",
      "description": "Schema.org type"
    },
    "id": {
      "type": "string",
      "pattern": "^[a-z_]+:[a-z0-9_-]+:[a-z_]+:v[0-9]+$",
      "description": "Unique entry identifier (domain:slug:category:version)"
    },
    "title": {
      "type": "string",
      "minLength": 5,
      "description": "Human-readable title"
    },
    "category": {
      "type": "string",
      "enum": [
        "sleep",
        "cognition", 
        "mental_health",
        "renal_safety",
        "cardiovascular"
      ],
      "description": "Evidence category"
    },
    "tier": {
      "type": "string",
      "enum": ["Gold", "Silver", "Bronze", "Red", "Black"],
      "description": "HBV 5-tier assignment"
    },
    "label": {
      "type": "string",
      "enum": ["PASS", "AMBER", "FAIL"],
      "description": "Overall assessment label"
    },
    "P_effect_gt_delta": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "Probability that effect > δ"
    },
    "gate_results": {
      "type": "object",
      "properties": {
        "phi": {
          "type": "string",
          "enum": ["PASS", "AMBER", "FAIL"],
          "description": "Φ gate (Natural/Category violation) result"
        },
        "r": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "R gate (Relevance) score"
        },
        "j": {
          "type": "number", 
          "minimum": 0,
          "maximum": 1,
          "description": "J gate (Journal Trust) score"
        },
        "k": {
          "type": "string",
          "enum": ["PASS", "AMBER", "FAIL"],
          "description": "K gate (Safety) result"
        },
        "l": {
          "type": "string",
          "enum": ["PASS", "FLAG"],
          "description": "L gate (Language exaggeration) result"
        }
      },
      "required": ["phi", "r", "j", "k", "l"],
      "additionalProperties": false,
      "description": "Results from all five gates"
    },
    "evidence_summary": {
      "type": "object",
      "properties": {
        "n_studies": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of studies included"
        },
        "I2": {
          "type": ["number", "null"],
          "minimum": 0,
          "maximum": 100,
          "description": "I² heterogeneity statistic"
        },
        "tau2": {
          "type": ["number", "null"],
          "minimum": 0,
          "description": "Between-study variance"
        }
      },
      "required": ["n_studies"],
      "additionalProperties": true,
      "description": "Summary of evidence base"
    },
    "policy_refs": {
      "type": "object",
      "properties": {
        "policy_version": {
          "type": "string",
          "description": "Version of policy.yaml used"
        },
        "journal_trust": {
          "type": "string",
          "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$",
          "description": "Date of journal trust snapshot"
        }
      },
      "required": ["policy_version", "journal_trust"],
      "additionalProperties": true,
      "description": "References to policy configuration"
    },
    "version": {
      "type": "string",
      "pattern": "^v[0-9]+$",
      "description": "Entry version"
    },
    "audit_hash": {
      "type": "string",
      "pattern": "^sha256:[a-f0-9]{64}$",
      "description": "SHA256 audit hash for integrity"
    },
    "policy_fingerprint": {
      "type": "string", 
      "pattern": "^sha256:[a-f0-9]{64}$",
      "description": "SHA256 fingerprint of policy configuration"
    },
    "created": {
      "type": "string",
      "format": "date-time",
      "description": "Entry creation timestamp (ISO 8601)"
    },
    "preferred_citation": {
      "type": "string",
      "description": "Preferred citation format"
    },
    "bibtex": {
      "type": "string",
      "description": "BibTeX citation"
    },
    "csl_json": {
      "type": "object",
      "description": "CSL-JSON citation data"
    },
    "doi": {
      "type": "string",
      "pattern": "^10\\..+",
      "description": "Digital Object Identifier"
    },
    "llm_hint": {
      "type": "string",
      "description": "Structured hint for LLM consumption"
    }
  },
  "required": [
    "@context",
    "@type", 
    "id",
    "title",
    "category",
    "tier",
    "label", 
    "P_effect_gt_delta",
    "gate_results",
    "evidence_summary",
    "policy_refs",
    "version",
    "audit_hash",
    "policy_fingerprint"
  ],
  "additionalProperties": true
}